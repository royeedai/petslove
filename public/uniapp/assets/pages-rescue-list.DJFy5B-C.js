import{r as a,o as e,y as s,v as t,a as l,w as c,i as u,b as o,d as n,e as i,f as r,t as d,S as f,k as _,F as v,l as p,q as m,h as g,p as b,z as y,s as k,A as h,u as x,B as w}from"./index-CD2lgknr.js";import{_ as C,r as j}from"./_plugin-vue_export-helper.DKEN6AQv.js";const F=C({__name:"list",setup(C){const F=a(0),L=a(0),T=a(0),z=a("all"),D=a(!1),I=a(!1),M=a(1),S=a([{label:"å…¨éƒ¨",value:"all",emoji:"ğŸ“‹"},{label:"å¾…æ•‘åŠ©",value:"pending",emoji:"ğŸ†˜"},{label:"æ•‘åŠ©ä¸­",value:"processing",emoji:"ğŸƒ"},{label:"å·²å®Œæˆ",value:"completed",emoji:"âœ…"}]),$=a([]);e(()=>{A(),N()}),s(z,()=>{q(),A()});const q=()=>{M.value=1,$.value=[],I.value=!1},A=async()=>{if(!D.value&&!I.value){D.value=!0;try{const a={page:M.value,size:10};"all"!==z.value&&(a.status=z.value);const e=await j.getTaskList(a);if(e.data&&e.data.records){const a=e.data.records.map(a=>({...a,cover:a.cover||"https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=600&q=80"}));1===M.value?$.value=a:$.value=[...$.value,...a],a.length<10&&(I.value=!0)}}catch(a){console.error("åŠ è½½æ•‘åŠ©ä»»åŠ¡åˆ—è¡¨å¤±è´¥",a),t({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{D.value=!1}}},B=()=>{D.value||I.value||(M.value++,A())},N=async()=>{try{const a=await j.getTaskList({page:1,size:100});if(a.data&&a.data.records){const e=a.data.records;F.value=e.filter(a=>"pending"===a.status||"processing"===a.status).length,L.value=e.filter(a=>"completed"===a.status).length,T.value=128}}catch(a){console.error("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥",a),F.value=15,L.value=89,T.value=128}},E=()=>{h("userInfo")?t({title:"å‘å¸ƒé¡µé¢å¼€å‘ä¸­",icon:"none"}):x({url:"/pages/login/index"})},G=a=>{if(!a)return"åˆšåˆš";const e=new Date,s=new Date(a),t=e-s,l=Math.floor(t/1e3/60);if(l<1)return"åˆšåˆš";if(l<60)return`${l}åˆ†é’Ÿå‰`;const c=Math.floor(l/60);if(c<24)return`${c}å°æ—¶å‰`;const u=Math.floor(c/24);return u<7?`${u}å¤©å‰`:s.toLocaleDateString()};return(a,e)=>{const s=i,C=u,M=f,q=b,N=y;return o(),l(C,{class:"page"},{default:c(()=>[n(C,{class:"stats-bar"},{default:c(()=>[n(C,{class:"stat-item"},{default:c(()=>[n(C,{class:"stat-icon-wrapper urgent"},{default:c(()=>[n(s,{class:"stat-icon"},{default:c(()=>[r("ğŸ†˜")]),_:1})]),_:1}),n(C,{class:"stat-info"},{default:c(()=>[n(s,{class:"stat-value"},{default:c(()=>[r(d(F.value),1)]),_:1}),n(s,{class:"stat-label"},{default:c(()=>[r("æ•‘åŠ©ä¸­")]),_:1})]),_:1})]),_:1}),n(C,{class:"stat-divider"}),n(C,{class:"stat-item"},{default:c(()=>[n(C,{class:"stat-icon-wrapper success"},{default:c(()=>[n(s,{class:"stat-icon"},{default:c(()=>[r("âœ…")]),_:1})]),_:1}),n(C,{class:"stat-info"},{default:c(()=>[n(s,{class:"stat-value"},{default:c(()=>[r(d(L.value),1)]),_:1}),n(s,{class:"stat-label"},{default:c(()=>[r("å·²å®Œæˆ")]),_:1})]),_:1})]),_:1}),n(C,{class:"stat-divider"}),n(C,{class:"stat-item"},{default:c(()=>[n(C,{class:"stat-icon-wrapper volunteer"},{default:c(()=>[n(s,{class:"stat-icon"},{default:c(()=>[r("ğŸ‘¥")]),_:1})]),_:1}),n(C,{class:"stat-info"},{default:c(()=>[n(s,{class:"stat-value"},{default:c(()=>[r(d(T.value),1)]),_:1}),n(s,{class:"stat-label"},{default:c(()=>[r("å¿—æ„¿è€…")]),_:1})]),_:1})]),_:1})]),_:1}),n(M,{"scroll-x":"",class:"status-scroll","show-scrollbar":"false"},{default:c(()=>[n(C,{class:"status-list"},{default:c(()=>[(o(!0),_(v,null,p(S.value,(a,e)=>(o(),l(C,{key:e,class:m(["status-item",{active:z.value===a.value}]),onClick:e=>{return s=a.value,void(z.value=s);var s}},{default:c(()=>[n(s,{class:"status-emoji"},{default:c(()=>[r(d(a.emoji),1)]),_:2},1024),n(s,{class:"status-text"},{default:c(()=>[r(d(a.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),n(M,{"scroll-y":"",class:"rescue-scroll",onScrolltolower:B},{default:c(()=>[n(C,{class:"rescue-list"},{default:c(()=>[(o(!0),_(v,null,p($.value,a=>(o(),l(C,{key:a.id,class:"rescue-card",onClick:a=>{t({title:"è¯¦æƒ…é¡µé¢å¼€å‘ä¸­",icon:"none"})}},{default:c(()=>["urgent"===a.urgencyLevel?(o(),l(C,{key:0,class:"urgent-badge"},{default:c(()=>[n(s,{class:"badge-pulse"}),n(s,{class:"urgent-icon"},{default:c(()=>[r("ğŸš¨")]),_:1}),n(s,{class:"urgent-text"},{default:c(()=>[r("ç´§æ€¥æ±‚åŠ©")]),_:1})]),_:1})):g("",!0),n(q,{src:a.cover,mode:"aspectFill",class:"rescue-image"},null,8,["src"]),n(C,{class:"rescue-content"},{default:c(()=>[n(s,{class:"rescue-title"},{default:c(()=>[r(d(a.title),1)]),_:2},1024),n(C,{class:"rescue-meta"},{default:c(()=>[n(C,{class:"meta-row"},{default:c(()=>[n(C,{class:"meta-item"},{default:c(()=>[n(s,{class:"meta-icon"},{default:c(()=>[r("ğŸ“")]),_:1}),n(s,{class:"meta-text"},{default:c(()=>[r(d(a.address),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),n(C,{class:"meta-row"},{default:c(()=>[n(C,{class:"meta-item"},{default:c(()=>[n(s,{class:"meta-icon"},{default:c(()=>[r("â°")]),_:1}),n(s,{class:"meta-text"},{default:c(()=>[r(d(G(a.createTime)),1)]),_:2},1024)]),_:2},1024),n(C,{class:"meta-item"},{default:c(()=>[n(s,{class:"meta-icon"},{default:c(()=>[r("ğŸ‘¤")]),_:1}),n(s,{class:"meta-text"},{default:c(()=>[r(d(a.reporterName),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),n(C,{class:"rescue-desc"},{default:c(()=>[r(d(a.description),1)]),_:2},1024),n(C,{class:"rescue-footer"},{default:c(()=>[n(C,{class:m(["status-badge",a.status])},{default:c(()=>[n(s,{class:"status-dot"}),n(s,{class:"status-text"},{default:c(()=>{return[r(d((e=a.status,{pending:"å¾…æ•‘åŠ©",processing:"æ•‘åŠ©ä¸­",completed:"å·²å®Œæˆ",cancelled:"å·²å–æ¶ˆ"}[e]||"æœªçŸ¥")),1)];var e}),_:2},1024)]),_:2},1032,["class"]),"pending"===a.status?(o(),l(N,{key:0,class:"btn-participate",onClick:k(e=>(async a=>{h("userInfo")?w({title:"ç¡®è®¤å‚ä¸",content:"ç¡®å®šè¦å‚ä¸è¿™ä¸ªæ•‘åŠ©ä»»åŠ¡å—ï¼Ÿ",confirmColor:"#FF8C42",success:async e=>{if(e.confirm)try{await j.acceptTask(a.id),t({title:"å‚ä¸æˆåŠŸ",icon:"success"}),A()}catch(s){console.error("å‚ä¸æ•‘åŠ©å¤±è´¥",s),t({title:"å‚ä¸å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}}):x({url:"/pages/login/index"})})(a),["stop"])},{default:c(()=>[n(s,{class:"btn-icon"},{default:c(()=>[r("ğŸ™‹")]),_:1}),n(s,{class:"btn-text"},{default:c(()=>[r("æˆ‘è¦å‚ä¸")]),_:1})]),_:2},1032,["onClick"])):"processing"===a.status?(o(),l(N,{key:1,class:"btn-detail",onClick:k(a=>{t({title:"è¿›åº¦é¡µé¢å¼€å‘ä¸­",icon:"none"})},["stop"])},{default:c(()=>[n(s,{class:"btn-icon"},{default:c(()=>[r("ğŸ“Š")]),_:1}),n(s,{class:"btn-text"},{default:c(()=>[r("æŸ¥çœ‹è¿›åº¦")]),_:1})]),_:2},1032,["onClick"])):(o(),l(C,{key:2,class:"completion-badge"},{default:c(()=>[n(s,{class:"completion-icon"},{default:c(()=>[r("ğŸ‰")]),_:1}),n(s,{class:"completion-text"},{default:c(()=>[r("å·²å®Œæˆ")]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),0!==$.value.length||D.value?g("",!0):(o(),l(C,{key:0,class:"empty-state"},{default:c(()=>[n(s,{class:"empty-icon"},{default:c(()=>[r("ğŸ”")]),_:1}),n(s,{class:"empty-title"},{default:c(()=>[r("æš‚æ— æ•‘åŠ©ä»»åŠ¡")]),_:1}),n(s,{class:"empty-description"},{default:c(()=>[r("æœŸå¾…æ‚¨çš„çˆ±å¿ƒå‚ä¸")]),_:1})]),_:1})),D.value?(o(),l(C,{key:1,class:"loading-state"},{default:c(()=>[n(C,{class:"loading-spinner"}),n(s,{class:"loading-text"},{default:c(()=>[r("åŠ è½½ä¸­...")]),_:1})]),_:1})):g("",!0),I.value&&$.value.length>0?(o(),l(C,{key:2,class:"no-more"},{default:c(()=>[n(s,{class:"no-more-text"},{default:c(()=>[r("æ²¡æœ‰æ›´å¤šäº†~")]),_:1})]),_:1})):g("",!0),n(C,{class:"list-footer"})]),_:1}),n(C,{class:"fab-btn",onClick:E},{default:c(()=>[n(s,{class:"fab-icon"},{default:c(()=>[r("ğŸ“")]),_:1})]),_:1})]),_:1})}}},[["__scopeId","data-v-77aa2184"]]);export{F as default};

import{r as e,o as a,y as l,A as s,v as t,a as o,w as c,i,b as n,d as u,p as r,e as d,f,S as m,k as v,F as k,l as _,q as g,t as p,h as C,u as h,C as y,x as b}from"./index-CD2lgknr.js";import{_ as x,c as w}from"./_plugin-vue_export-helper.DKEN6AQv.js";const L=x({__name:"list",setup(x){const L=e(null),j=e("all"),I=e(!1),M=e(!1),S=e(1),$=e([{label:"å…¨éƒ¨",value:"all",emoji:"ðŸ“‹"},{label:"æ•‘åŠ©æ•…äº‹",value:"rescue",emoji:"ðŸ†˜"},{label:"é¢†å…»æ—¥è®°",value:"adoption",emoji:"ðŸ "},{label:"èŒå® æ—¥å¸¸",value:"daily",emoji:"ðŸ¾"},{label:"æ±‚åŠ©",value:"help",emoji:"â“"},{label:"çŸ¥è¯†åˆ†äº«",value:"knowledge",emoji:"ðŸ“–"}]),A=e([]);a(()=>{D(),N()}),l(j,()=>{F(),N()});const F=()=>{S.value=1,A.value=[],M.value=!1},D=()=>{const e=s("userInfo");e&&(L.value=e)},N=async()=>{if(!I.value&&!M.value){I.value=!0;try{const e={page:S.value,size:10};"all"!==j.value&&(e.category=j.value);const a=await w.getPostList(e);if(a.data&&a.data.records){const e=a.data.records.map(e=>({...e,userAvatar:e.userAvatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.userId}`,isLiked:!1}));1===S.value?A.value=e:A.value=[...A.value,...e],e.length<10&&(M.value=!0)}}catch(e){console.error("åŠ è½½ç¤¾åŒºåŠ¨æ€å¤±è´¥",e),t({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{I.value=!1}}},T=()=>{I.value||M.value||(S.value++,N())},q=()=>{L.value?t({title:"å‘å¸ƒé¡µé¢å¼€å‘ä¸­",icon:"none"}):h({url:"/pages/login/index"})},z=e=>{L.value?t({title:"è¯„è®ºåŠŸèƒ½å¼€å‘ä¸­",icon:"none"}):h({url:"/pages/login/index"})},P=e=>{if(!e)return"åˆšåˆš";const a=new Date,l=new Date(e),s=a-l,t=Math.floor(s/1e3/60);if(t<1)return"åˆšåˆš";if(t<60)return`${t}åˆ†é’Ÿå‰`;const o=Math.floor(t/60);if(o<24)return`${o}å°æ—¶å‰`;const c=Math.floor(o/24);return c<7?`${c}å¤©å‰`:l.toLocaleDateString()};return(e,a)=>{const l=r,s=d,x=i,S=m;return n(),o(x,{class:"page"},{default:c(()=>[u(x,{class:"publish-bar",onClick:q},{default:c(()=>{var e;return[u(l,{src:(null==(e=L.value)?void 0:e.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=default",mode:"aspectFill",class:"user-avatar"},null,8,["src"]),u(x,{class:"publish-input"},{default:c(()=>[u(s,{class:"publish-placeholder"},{default:c(()=>[f("åˆ†äº«ä½ çš„çˆ±å® æ•…äº‹...")]),_:1}),u(x,{class:"publish-icons"},{default:c(()=>[u(s,{class:"icon"},{default:c(()=>[f("ðŸ“·")]),_:1}),u(s,{class:"icon"},{default:c(()=>[f("ðŸ˜Š")]),_:1})]),_:1})]),_:1}),u(x,{class:"publish-btn"},{default:c(()=>[u(s,{class:"publish-icon"},{default:c(()=>[f("ðŸ“")]),_:1})]),_:1})]}),_:1}),u(S,{"scroll-x":"",class:"category-scroll","show-scrollbar":"false"},{default:c(()=>[u(x,{class:"category-list"},{default:c(()=>[(n(!0),v(k,null,_($.value,(e,a)=>(n(),o(x,{key:a,class:g(["category-item",{active:j.value===e.value}]),onClick:a=>{return l=e.value,void(j.value=l);var l}},{default:c(()=>[u(s,{class:"category-emoji"},{default:c(()=>[f(p(e.emoji),1)]),_:2},1024),u(s,{class:"category-text"},{default:c(()=>[f(p(e.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),u(S,{"scroll-y":"",class:"post-scroll",onScrolltolower:T},{default:c(()=>[u(x,{class:"post-list"},{default:c(()=>[(n(!0),v(k,null,_(A.value,e=>(n(),o(x,{key:e.id,class:"post-card"},{default:c(()=>{return[u(x,{class:"post-header"},{default:c(()=>[u(l,{src:e.userAvatar,mode:"aspectFill",class:"avatar",onClick:a=>(e.userId,void t({title:"ç”¨æˆ·ä¸»é¡µå¼€å‘ä¸­",icon:"none"}))},null,8,["src","onClick"]),u(x,{class:"user-info"},{default:c(()=>[u(s,{class:"nickname"},{default:c(()=>[f(p(e.userNickname),1)]),_:2},1024),u(s,{class:"time"},{default:c(()=>[f(p(P(e.createTime)),1)]),_:2},1024)]),_:2},1024),u(x,{class:"more-btn",onClick:a=>(e=>{const a=["ä¸¾æŠ¥","ä¸æ„Ÿå…´è¶£"];L.value&&e.userId===L.value.id&&a.unshift("åˆ é™¤"),y({itemList:a,success:e=>{console.log("é€‰æ‹©äº†ï¼š",a[e.tapIndex])}})})(e)},{default:c(()=>[u(s,{class:"more-icon"},{default:c(()=>[f("â‹¯")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),u(x,{class:"post-content"},{default:c(()=>[u(s,{class:"content-text"},{default:c(()=>[f(p(e.content),1)]),_:2},1024)]),_:2},1024),e.images&&e.images.length>0?(n(),o(x,{key:0,class:g(["image-grid",(a=e.images.length,1===a?"grid-1":2===a?"grid-2":4===a?"grid-4":"grid-3")])},{default:c(()=>[(n(!0),v(k,null,_(e.images,(a,s)=>(n(),o(l,{key:s,src:a,mode:"aspectFill",class:"post-image",onClick:a=>{return l=e.images,void b({urls:l,current:s});var l}},null,8,["src","onClick"]))),128))]),_:2},1032,["class"])):C("",!0),e.tags&&e.tags.length>0?(n(),o(x,{key:1,class:"tags-wrapper"},{default:c(()=>[(n(!0),v(k,null,_(e.tags,(e,a)=>(n(),o(x,{key:a,class:"tag-item",onClick:a=>(e=>{console.log("ç‚¹å‡»æ ‡ç­¾ï¼š",e),t({title:`è¯é¢˜ #${e}`,icon:"none"})})(e)},{default:c(()=>[f(" #"+p(e),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)):C("",!0),u(x,{class:"post-actions"},{default:c(()=>[u(x,{class:"action-item",onClick:a=>(async e=>{if(L.value)try{const a=await w.toggleLike("post",e.id);e.isLiked=a.data.liked,e.isLiked?e.likeCount=(e.likeCount||0)+1:e.likeCount=Math.max(0,(e.likeCount||0)-1)}catch(a){console.error("ç‚¹èµžå¤±è´¥",a),e.isLiked=!e.isLiked,e.isLiked?e.likeCount=(e.likeCount||0)+1:e.likeCount=Math.max(0,(e.likeCount||0)-1)}else h({url:"/pages/login/index"})})(e)},{default:c(()=>[u(s,{class:g(["action-icon",{liked:e.isLiked}])},{default:c(()=>[f(p(e.isLiked?"â¤ï¸":"ðŸ¤"),1)]),_:2},1032,["class"]),u(s,{class:g(["action-text",{active:e.isLiked}])},{default:c(()=>[f(p(e.likeCount>0?e.likeCount:"ç‚¹èµž"),1)]),_:2},1032,["class"])]),_:2},1032,["onClick"]),u(x,{class:"action-item",onClick:e=>z()},{default:c(()=>[u(s,{class:"action-icon"},{default:c(()=>[f("ðŸ’¬")]),_:1}),u(s,{class:"action-text"},{default:c(()=>[f(p(e.commentCount>0?e.commentCount:"è¯„è®º"),1)]),_:2},1024)]),_:2},1032,["onClick"]),u(x,{class:"action-item",onClick:e=>{uni.showShareMenu({withShareTicket:!0})}},{default:c(()=>[u(s,{class:"action-icon"},{default:c(()=>[f("ðŸ“¤")]),_:1}),u(s,{class:"action-text"},{default:c(()=>[f("åˆ†äº«")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),e.hotComments&&e.hotComments.length>0?(n(),o(x,{key:2,class:"comments-preview"},{default:c(()=>[(n(!0),v(k,null,_(e.hotComments.slice(0,2),(e,a)=>(n(),o(x,{key:a,class:"comment-item"},{default:c(()=>[u(s,{class:"comment-user"},{default:c(()=>[f(p(e.userNickname)+"ï¼š",1)]),_:2},1024),u(s,{class:"comment-content"},{default:c(()=>[f(p(e.content),1)]),_:2},1024)]),_:2},1024))),128)),e.commentCount>2?(n(),o(x,{key:0,class:"view-all-comments",onClick:e=>z()},{default:c(()=>[f(" æŸ¥çœ‹å…¨éƒ¨ "+p(e.commentCount)+" æ¡è¯„è®º â€º ",1)]),_:2},1032,["onClick"])):C("",!0)]),_:2},1024)):C("",!0)];var a}),_:2},1024))),128))]),_:1}),0!==A.value.length||I.value?C("",!0):(n(),o(x,{key:0,class:"empty-state"},{default:c(()=>[u(s,{class:"empty-icon"},{default:c(()=>[f("ðŸ’¬")]),_:1}),u(s,{class:"empty-title"},{default:c(()=>[f("æš‚æ— ç¤¾åŒºåŠ¨æ€")]),_:1}),u(s,{class:"empty-description"},{default:c(()=>[f("å¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡åŠ¨æ€å§")]),_:1})]),_:1})),I.value?(n(),o(x,{key:1,class:"loading-state"},{default:c(()=>[u(x,{class:"loading-spinner"}),u(s,{class:"loading-text"},{default:c(()=>[f("åŠ è½½ä¸­...")]),_:1})]),_:1})):C("",!0),M.value&&A.value.length>0?(n(),o(x,{key:2,class:"no-more"},{default:c(()=>[u(s,{class:"no-more-text"},{default:c(()=>[f("æ²¡æœ‰æ›´å¤šäº†~")]),_:1})]),_:1})):C("",!0),u(x,{class:"list-footer"})]),_:1})]),_:1})}}},[["__scopeId","data-v-eabe2108"]]);export{L as default};

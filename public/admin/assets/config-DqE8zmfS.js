import{s as w,_ as z,r as b,h as T,c as k,o as g,b as i,d as l,w as o,e as p,E as m,i as K,m as q,p as P,g as _,n as S,F as W}from"./index-C9AwdplH.js";function j(){return w({url:"/system/configs",method:"get"})}function C(v){return w({url:"/system/config",method:"post",params:v})}function G(v){const n=new FormData;return n.append("file",v),w({url:"/system/file/upload/image",method:"post",data:n,headers:{"Content-Type":"multipart/form-data"}})}const H={class:"page-container"},J={class:"card-header"},Q=["src"],R={class:"card-header"},X={class:"card-header"},Y={__name:"config",setup(v){const n=b({site_name:"",site_logo:"",contact_phone:"",contact_email:""}),u=b({points_sign:5,points_post:10,points_rescue:50,points_adoption:100,points_donation:20}),s=b({storage_type:"local",oss_access_key_id:"",oss_access_key_secret:"",oss_endpoint:"",oss_bucket_name:"",oss_domain:""}),x=async()=>{try{const t=await j();t.code===200&&t.data.forEach(d=>{d.configKey in n.value&&(n.value[d.configKey]=d.configValue),d.configKey in u.value&&(u.value[d.configKey]=parseInt(d.configValue)),d.configKey in s.value&&(s.value[d.configKey]=d.configValue)})}catch(t){console.error("加载配置失败",t),m.error("加载配置失败")}},B=async()=>{try{for(const t in n.value)await C({configKey:t,configValue:n.value[t],description:""});m.success("保存成功")}catch(t){console.error("保存失败",t),m.error("保存失败")}},I=async()=>{try{for(const t in u.value)await C({configKey:t,configValue:u.value[t].toString(),description:""});m.success("保存成功")}catch(t){console.error("保存失败",t),m.error("保存失败")}},A=async()=>{try{for(const t in s.value)await C({configKey:t,configValue:s.value[t],description:""});m.success("保存成功，配置将在下次启动时生效")}catch(t){console.error("保存失败",t),m.error("保存失败")}},E=t=>{const e=t.type.startsWith("image/"),d=t.size/1024/1024<2;return e?d?!0:(m.error("图片大小不能超过 2MB!"),!1):(m.error("只能上传图片文件!"),!1)},N=async({file:t})=>{try{const e=await G(t);e.code===200&&(n.value.site_logo=e.data.url,m.success("上传成功"))}catch(e){console.error("上传失败",e),m.error("上传失败")}};return T(()=>{x()}),(t,e)=>{const d=p("el-button"),c=p("el-input"),r=p("el-form-item"),O=p("el-icon"),M=p("el-upload"),y=p("el-form"),V=p("el-card"),f=p("el-input-number"),U=p("el-radio"),D=p("el-radio-group"),F=p("el-divider"),L=p("el-alert");return g(),k("div",H,[e[24]||(e[24]=i("div",{class:"page-header"},[i("h2",{class:"page-title"},"系统配置")],-1)),l(V,{class:"config-card"},{header:o(()=>[i("div",J,[e[15]||(e[15]=i("span",null,"基础配置",-1)),l(d,{type:"primary",onClick:B},{default:o(()=>[...e[14]||(e[14]=[_("保存基础配置",-1)])]),_:1})])]),default:o(()=>[l(y,{model:n.value,"label-width":"120px"},{default:o(()=>[l(r,{label:"网站名称"},{default:o(()=>[l(c,{modelValue:n.value.site_name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.site_name=a),placeholder:"请输入网站名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"联系电话"},{default:o(()=>[l(c,{modelValue:n.value.contact_phone,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.contact_phone=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(r,{label:"联系邮箱"},{default:o(()=>[l(c,{modelValue:n.value.contact_email,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.contact_email=a),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1}),l(r,{label:"网站Logo"},{default:o(()=>[l(M,{class:"logo-uploader","show-file-list":!1,"http-request":N,"before-upload":E},{default:o(()=>[n.value.site_logo?(g(),k("img",{key:0,src:n.value.site_logo,class:"logo"},null,8,Q)):(g(),K(O,{key:1,class:"logo-uploader-icon"},{default:o(()=>[l(q(P))]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(V,{class:"config-card",style:{"margin-top":"20px"}},{header:o(()=>[i("div",R,[e[17]||(e[17]=i("span",null,"积分配置",-1)),l(d,{type:"primary",onClick:I},{default:o(()=>[...e[16]||(e[16]=[_("保存积分配置",-1)])]),_:1})])]),default:o(()=>[l(y,{model:u.value,"label-width":"120px"},{default:o(()=>[l(r,{label:"签到积分"},{default:o(()=>[l(f,{modelValue:u.value.points_sign,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.points_sign=a),min:0},null,8,["modelValue"])]),_:1}),l(r,{label:"发帖积分"},{default:o(()=>[l(f,{modelValue:u.value.points_post,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.points_post=a),min:0},null,8,["modelValue"])]),_:1}),l(r,{label:"救助积分"},{default:o(()=>[l(f,{modelValue:u.value.points_rescue,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.points_rescue=a),min:0},null,8,["modelValue"])]),_:1}),l(r,{label:"领养积分"},{default:o(()=>[l(f,{modelValue:u.value.points_adoption,"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.points_adoption=a),min:0},null,8,["modelValue"])]),_:1}),l(r,{label:"捐赠积分"},{default:o(()=>[l(f,{modelValue:u.value.points_donation,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.points_donation=a),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(V,{class:"config-card",style:{"margin-top":"20px"}},{header:o(()=>[i("div",X,[e[19]||(e[19]=i("span",null,"存储配置",-1)),l(d,{type:"primary",onClick:A},{default:o(()=>[...e[18]||(e[18]=[_("保存存储配置",-1)])]),_:1})])]),default:o(()=>[l(y,{model:s.value,"label-width":"140px"},{default:o(()=>[l(r,{label:"存储方式"},{default:o(()=>[l(D,{modelValue:s.value.storage_type,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.storage_type=a)},{default:o(()=>[l(U,{value:"local"},{default:o(()=>[...e[20]||(e[20]=[_("本地存储",-1)])]),_:1}),l(U,{value:"oss"},{default:o(()=>[...e[21]||(e[21]=[_("阿里云OSS",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s.value.storage_type==="oss"?(g(),k(W,{key:0},[l(F,{"content-position":"left"},{default:o(()=>[...e[22]||(e[22]=[_("阿里云OSS配置",-1)])]),_:1}),l(r,{label:"AccessKeyId"},{default:o(()=>[l(c,{modelValue:s.value.oss_access_key_id,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.oss_access_key_id=a),placeholder:"请输入阿里云OSS AccessKeyId","show-password":""},null,8,["modelValue"])]),_:1}),l(r,{label:"AccessKeySecret"},{default:o(()=>[l(c,{modelValue:s.value.oss_access_key_secret,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.oss_access_key_secret=a),placeholder:"请输入阿里云OSS AccessKeySecret","show-password":""},null,8,["modelValue"])]),_:1}),l(r,{label:"Endpoint"},{default:o(()=>[l(c,{modelValue:s.value.oss_endpoint,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.oss_endpoint=a),placeholder:"例如：oss-cn-shenzhen.aliyuncs.com"},null,8,["modelValue"])]),_:1}),l(r,{label:"Bucket名称"},{default:o(()=>[l(c,{modelValue:s.value.oss_bucket_name,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.oss_bucket_name=a),placeholder:"请输入Bucket名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"访问域名"},{default:o(()=>[l(c,{modelValue:s.value.oss_domain,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.oss_domain=a),placeholder:"选填，如配置了自定义域名请填写"},null,8,["modelValue"])]),_:1})],64)):S("",!0)]),_:1},8,["model"]),s.value.storage_type==="oss"?(g(),K(L,{key:0,type:"info",closable:!1,style:{"margin-top":"20px"}},{title:o(()=>[...e[23]||(e[23]=[i("div",null,[i("p",null,"阿里云OSS配置说明："),i("ul",{style:{margin:"10px 0","padding-left":"20px"}},[i("li",null,"AccessKeyId和AccessKeySecret可在阿里云控制台获取"),i("li",null,"Endpoint格式：oss-[区域].aliyuncs.com"),i("li",null,"访问域名为选填项，如未配置自定义域名可不填"),i("li",null,"请确保Bucket已设置公共读权限或配置了CDN加速域名")])],-1)])]),_:1})):S("",!0)]),_:1})])}}},$=z(Y,[["__scopeId","data-v-e3d4aec1"]]);export{$ as default};

# 第二阶段：用户系统开发总结

## 开发周期
预计：2周  
实际：已完成核心功能开发

## 完成情况

### ✅ 后端开发（Spring Boot）

#### 1. 用户基础层
- [x] **UserMapper** - 用户数据访问层
  - 根据openid/手机号查询用户
  - 积分增加/扣减操作
  - 配套XML映射文件

- [x] **UserService** - 用户业务逻辑层
  - 用户信息查询与更新
  - 登录注册逻辑
  - 实名认证业务
  - 积分管理业务

#### 2. 用户登录功能
- [x] **微信授权登录**
  - 微信小程序授权接口集成
  - 自动注册新用户
  - JWT Token生成
  - 用户信息更新

- [x] **手机号登录/注册**
  - 短信验证码发送（预留接口）
  - 验证码校验（Redis缓存）
  - 一键登录注册
  - Token颁发

#### 3. 用户信息管理
- [x] **获取用户信息接口**
- [x] **更新用户信息接口**
  - 昵称、头像、性别
  - 手机号（唯一性校验）

#### 4. 实名认证功能
- [x] **实名认证接口**
  - 身份证格式校验
  - 实名信息存储
  - 认证状态管理
  - 预留第三方认证接口

#### 5. 积分系统基础
- [x] **UserPointsRecord** - 积分记录实体
- [x] **积分增加接口**
  - 支持多种积分类型（签到、救助、领养、捐赠等）
  - 自动创建积分记录
- [x] **积分扣减接口**
  - 积分余额校验
  - 防止负数扣减
- [x] **积分记录查询**
  - 按用户ID查询
  - 支持分页限制

#### 6. DTO层设计
- [x] LoginRequest - 登录请求
- [x] WxLoginRequest - 微信登录请求
- [x] UserUpdateRequest - 用户更新请求
- [x] VerifyRequest - 实名认证请求
- [x] LoginResponse - 登录响应

#### 7. 配置文件
- [x] 微信小程序配置（appid、secret）
- [x] JWT配置
- [x] Redis配置

---

### ✅ 小程序端开发（UniApp）

#### 1. 项目结构
```
mengyo-uniapp/
├── pages/              # 页面目录
│   ├── index/         # 首页
│   ├── login/         # 登录页
│   ├── user/          # 用户中心
│   ├── rescue/        # 救助
│   ├── animal/        # 动物
│   └── community/     # 社区
├── utils/             # 工具类
│   ├── request.js     # 网络请求封装
│   └── api.js         # API接口定义
├── static/            # 静态资源
├── App.vue            # 应用入口
├── main.js            # 主入口
├── pages.json         # 页面配置
├── manifest.json      # 应用配置
└── package.json       # 依赖配置
```

#### 2. 核心功能
- [x] **登录页面**
  - 微信一键登录
  - 手机号+验证码登录
  - Tab切换
  - 验证码倒计时

- [x] **首页**
  - 轮播图
  - 功能入口
  - 最新救助任务
  - 社区动态

- [x] **用户中心**
  - 用户信息展示
  - 积分显示
  - 实名认证入口
  - 功能菜单
  - 退出登录

- [x] **网络请求封装**
  - 统一请求拦截
  - Token自动携带
  - 错误处理
  - 响应拦截

- [x] **API接口定义**
  - 用户相关接口
  - 统一接口管理

#### 3. 占位页面
- [x] 救助任务列表
- [x] 流浪动物列表
- [x] 社区列表

---

### ✅ 管理后台开发（Vue 3）

#### 1. 项目结构
```
mengyo-admin/
├── src/
│   ├── api/            # API接口
│   ├── assets/         # 资源文件
│   ├── components/     # 公共组件
│   ├── layout/         # 布局组件
│   │   ├── index.vue          # 主布局
│   │   └── components/
│   │       └── SidebarItem.vue # 侧边栏菜单项
│   ├── router/         # 路由配置
│   ├── stores/         # Pinia状态管理
│   │   └── user.js     # 用户状态
│   ├── styles/         # 全局样式
│   ├── utils/          # 工具函数
│   │   └── request.js  # Axios封装
│   ├── views/          # 页面视图
│   │   ├── login/      # 登录
│   │   ├── dashboard/  # 数据概览
│   │   ├── user/       # 用户管理
│   │   ├── animal/     # 动物管理
│   │   ├── rescue/     # 救助管理
│   │   ├── adoption/   # 领养管理
│   │   ├── donation/   # 捐赠管理
│   │   ├── community/  # 社区管理
│   │   └── system/     # 系统管理
│   ├── App.vue
│   └── main.js
├── index.html
├── vite.config.js
└── package.json
```

#### 2. 核心功能
- [x] **登录系统**
  - 手机号+验证码登录
  - Token管理
  - 路由守卫

- [x] **基础布局**
  - 侧边栏导航
  - 可折叠菜单
  - 顶部导航栏
  - 用户信息下拉菜单

- [x] **数据概览**
  - 统计卡片
  - 最近救助任务
  - 最新用户

- [x] **用户管理**
  - 用户列表
  - 搜索功能（手机号、昵称、状态）
  - 用户编辑
  - 状态管理（启用/禁用）
  - 积分管理入口
  - 分页功能

- [x] **状态管理**
  - Pinia store
  - 用户状态
  - Token持久化

- [x] **网络请求**
  - Axios封装
  - 请求/响应拦截
  - 统一错误处理
  - Token自动携带

#### 3. 占位页面
- [x] 积分管理
- [x] 动物管理
- [x] 救助任务管理
- [x] 领养申请管理
- [x] 捐赠记录管理
- [x] 社区管理（帖子、评论）
- [x] 系统配置
- [x] 轮播图管理

---

## 技术栈

### 后端
- Spring Boot 3.2.0
- MyBatis Plus 3.5.5
- MySQL 8.0
- Redis
- JWT
- Hutool 工具库

### 小程序端
- UniApp 3.x
- Vue 3
- Sass

### 管理后台
- Vue 3.3+
- Vite 5.0+
- Element Plus 2.4+
- Pinia 2.1+
- Vue Router 4.2+
- Axios 1.6+

---

## 接口列表

### 用户相关
| 接口 | 方法 | 路径 | 说明 |
|-----|------|------|------|
| 微信登录 | POST | /api/user/wx-login | 微信小程序授权登录 |
| 手机登录 | POST | /api/user/phone-login | 手机号+验证码登录 |
| 发送验证码 | POST | /api/user/send-code | 发送短信验证码 |
| 获取用户信息 | GET | /api/user/info | 查询用户详情 |
| 更新用户信息 | PUT | /api/user/info | 更新用户资料 |
| 实名认证 | POST | /api/user/verify | 提交实名认证 |
| 积分记录 | GET | /api/user/points/records | 查询积分记录 |
| 增加积分 | POST | /api/user/points/add | 管理员增加用户积分 |
| 扣减积分 | POST | /api/user/points/deduct | 管理员扣减用户积分 |

---

## 数据库表

### 用户相关表
- `user` - 用户表
- `user_points_record` - 用户积分记录表
- `user_address` - 用户地址表（已设计，待开发）

---

## 项目文件清单

### 后端文件
```
mengyo-backend/src/main/java/com/mengyo/
├── module/user/
│   ├── controller/
│   │   └── UserController.java
│   ├── dto/
│   │   ├── LoginRequest.java
│   │   ├── LoginResponse.java
│   │   ├── WxLoginRequest.java
│   │   ├── UserUpdateRequest.java
│   │   └── VerifyRequest.java
│   ├── entity/
│   │   ├── User.java
│   │   └── UserPointsRecord.java
│   ├── mapper/
│   │   ├── UserMapper.java
│   │   └── UserPointsRecordMapper.java
│   └── service/
│       ├── UserService.java
│       ├── UserPointsRecordService.java
│       └── impl/
│           ├── UserServiceImpl.java
│           └── UserPointsRecordServiceImpl.java
└── resources/
    ├── mapper/user/
    │   └── UserMapper.xml
    └── application-dev.yml（已添加微信配置）
```

### 小程序文件
```
mengyo-uniapp/
├── pages/
│   ├── index/index.vue
│   ├── login/index.vue
│   ├── user/index.vue
│   ├── rescue/list.vue
│   ├── animal/list.vue
│   └── community/list.vue
├── utils/
│   ├── request.js
│   └── api.js
├── App.vue
├── main.js
├── pages.json
├── manifest.json
├── package.json
└── README.md
```

### 管理后台文件
```
mengyo-admin/
├── src/
│   ├── layout/
│   │   ├── index.vue
│   │   └── components/SidebarItem.vue
│   ├── router/index.js
│   ├── stores/user.js
│   ├── utils/request.js
│   ├── api/user.js
│   ├── views/
│   │   ├── login/index.vue
│   │   ├── dashboard/index.vue
│   │   └── user/
│   │       ├── list.vue
│   │       └── points.vue
│   ├── App.vue
│   └── main.js
├── vite.config.js
├── package.json
└── README.md
```

---

## 运行指南

### 1. 启动后端服务
```bash
cd mengyo-backend
mvn spring-boot:run
```
访问地址：http://localhost:8080/api

### 2. 启动小程序
```bash
cd mengyo-uniapp
npm install
npm run dev:mp-weixin
```
使用微信开发者工具打开项目

### 3. 启动管理后台
```bash
cd mengyo-admin
npm install
npm run dev
```
访问地址：http://localhost:3000

---

## 注意事项

### 配置项
1. **微信小程序配置**（application-dev.yml）
   - 需要配置真实的微信小程序 appid 和 secret
   
2. **数据库配置**（application-dev.yml）
   - 确保MySQL已启动
   - 执行 database/init.sql 初始化数据库

3. **Redis配置**（application-dev.yml）
   - 确保Redis已启动
   - 默认端口6379

### 待完善功能
1. 短信验证码真实发送（目前使用Redis模拟）
2. 实名认证第三方接口对接
3. 微信支付接口对接
4. 文件上传功能
5. 用户列表查询接口（管理后台需要）

---

## 下一步计划

### 第三阶段：动物管理系统
- 流浪动物信息管理
- 动物图片上传
- 地理位置标注
- 动物状态管理

### 第四阶段：救助系统
- 救助任务发布
- 任务接单
- 救助进度跟踪
- 救助记录

### 第五阶段：领养与捐赠
- 领养申请与审核
- 领养回访
- 捐赠功能
- 支付接口对接

---

## 总结

第二阶段用户系统开发已完成，实现了：
- ✅ 完整的用户登录注册体系
- ✅ 用户信息管理
- ✅ 实名认证功能
- ✅ 积分系统基础
- ✅ 小程序端基础页面
- ✅ 管理后台基础框架

所有核心功能均已开发完成，可以进入下一阶段开发！

---

**开发日期**: 2025-11-21  
**开发团队**: Mengyo Team

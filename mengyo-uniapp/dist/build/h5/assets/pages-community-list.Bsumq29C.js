import{r as a,o as e,k as l,x as s,c as t,w as c,i as o,a as i,b as n,g as u,h as r,j as d,l as m,d as f,F as _,e as k,m as g,t as p,p as v,n as C,u as h,y,z as x}from"./index-DsnV_1T9.js";import{_ as b,c as j}from"./_plugin-vue_export-helper.DGOf1M-5.js";const w=b({__name:"list",setup(b){const w=a(null),L=a("all"),I=a([{label:"å…¨éƒ¨",value:"all",emoji:"ğŸ“‹"},{label:"æ•‘åŠ©æ•…äº‹",value:"rescue",emoji:"ğŸ†˜"},{label:"é¢†å…»æ—¥è®°",value:"adoption",emoji:"ğŸ "},{label:"èŒå® æ—¥å¸¸",value:"daily",emoji:"ğŸ¾"},{label:"æ±‚åŠ©",value:"help",emoji:"â“"}]),M=a([]);e(()=>{F(),$()}),l(L,()=>{$()});const F=()=>{const a=s("userInfo");a&&(w.value=a)},$=async()=>{try{const a={page:1,size:20};"all"!==L.value&&(a.category=L.value);const e=await j.getPostList(a);e.data&&e.data.records&&(M.value=e.data.records.map(a=>({...a,userAvatar:a.userAvatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${a.userId}`,isLiked:!1})))}catch(a){console.error("åŠ è½½ç¤¾åŒºåŠ¨æ€å¤±è´¥",a)}},A=()=>{w.value?h({title:"å‘å¸ƒé¡µé¢å¼€å‘ä¸­",icon:"none"}):C({url:"/pages/login/index"})},D=a=>{w.value?h({title:"è¯„è®ºåŠŸèƒ½å¼€å‘ä¸­",icon:"none"}):C({url:"/pages/login/index"})},S=a=>{if(!a)return"åˆšåˆš";const e=new Date,l=new Date(a),s=e-l,t=Math.floor(s/1e3/60);if(t<1)return"åˆšåˆš";if(t<60)return`${t}åˆ†é’Ÿå‰`;const c=Math.floor(t/60);if(c<24)return`${c}å°æ—¶å‰`;const o=Math.floor(c/24);return o<7?`${o}å¤©å‰`:l.toLocaleDateString()};return(a,e)=>{const l=u,s=r,b=o,F=m;return i(),t(b,{class:"page"},{default:c(()=>[n(b,{class:"publish-bar",onClick:A},{default:c(()=>{var a;return[n(l,{src:(null==(a=w.value)?void 0:a.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=default",mode:"aspectFill",class:"user-avatar"},null,8,["src"]),n(b,{class:"publish-input"},{default:c(()=>[n(s,{class:"publish-placeholder"},{default:c(()=>[d("åˆ†äº«ä½ çš„çˆ±å® æ•…äº‹...")]),_:1})]),_:1}),n(b,{class:"publish-btn"},{default:c(()=>[n(s,{class:"publish-icon"},{default:c(()=>[d("ğŸ“")]),_:1})]),_:1})]}),_:1}),n(F,{"scroll-x":"",class:"category-scroll"},{default:c(()=>[n(b,{class:"category-list"},{default:c(()=>[(i(!0),f(_,null,k(I.value,(a,e)=>(i(),t(b,{key:e,class:g(["category-item",{active:L.value===a.value}]),onClick:e=>L.value=a.value},{default:c(()=>[n(s,{class:"category-emoji"},{default:c(()=>[d(p(a.emoji),1)]),_:2},1024),n(s,{class:"category-text"},{default:c(()=>[d(p(a.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),n(b,{class:"post-list"},{default:c(()=>[(i(!0),f(_,null,k(M.value,a=>(i(),t(b,{key:a.id,class:"post-card"},{default:c(()=>{return[n(b,{class:"post-header"},{default:c(()=>[n(l,{src:a.userAvatar,mode:"aspectFill",class:"avatar",onClick:e=>(a.userId,void h({title:"ç”¨æˆ·ä¸»é¡µå¼€å‘ä¸­",icon:"none"}))},null,8,["src","onClick"]),n(b,{class:"user-info"},{default:c(()=>[n(s,{class:"nickname"},{default:c(()=>[d(p(a.userNickname),1)]),_:2},1024),n(s,{class:"time"},{default:c(()=>[d(p(S(a.createTime)),1)]),_:2},1024)]),_:2},1024),n(b,{class:"more-btn",onClick:a=>{y({itemList:["ä¸¾æŠ¥","ä¸æ„Ÿå…´è¶£"],success:a=>{console.log("é€‰æ‹©äº†ï¼š"+a.tapIndex)}})}},{default:c(()=>[n(s,{class:"more-icon"},{default:c(()=>[d("â‹¯")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),n(b,{class:"post-content"},{default:c(()=>[n(s,{class:"content-text"},{default:c(()=>[d(p(a.content),1)]),_:2},1024)]),_:2},1024),a.images&&a.images.length>0?(i(),t(b,{key:0,class:g(["image-grid",(e=a.images.length,1===e?"grid-1":2===e?"grid-2":4===e?"grid-4":"grid-3")])},{default:c(()=>[(i(!0),f(_,null,k(a.images,(e,s)=>(i(),t(l,{key:s,src:e,mode:"aspectFill",class:"post-image",onClick:e=>{return l=a.images,void x({urls:l,current:s});var l}},null,8,["src","onClick"]))),128))]),_:2},1032,["class"])):v("",!0),a.tags&&a.tags.length>0?(i(),t(b,{key:1,class:"tags-wrapper"},{default:c(()=>[(i(!0),f(_,null,k(a.tags,(a,e)=>(i(),t(b,{key:e,class:"tag-item",onClick:e=>(a=>{console.log("ç‚¹å‡»æ ‡ç­¾ï¼š",a)})(a)},{default:c(()=>[d(" #"+p(a),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)):v("",!0),n(b,{class:"post-actions"},{default:c(()=>[n(b,{class:"action-item",onClick:e=>(async a=>{if(w.value)try{const e=await j.toggleLike("post",a.id);a.isLiked=e.data.liked,a.isLiked?a.likeCount=(a.likeCount||0)+1:a.likeCount=Math.max(0,(a.likeCount||0)-1)}catch(e){console.error("ç‚¹èµå¤±è´¥",e)}else C({url:"/pages/login/index"})})(a)},{default:c(()=>[n(s,{class:g(["action-icon",{liked:a.isLiked}])},{default:c(()=>[d(p(a.isLiked?"â¤ï¸":"ğŸ¤"),1)]),_:2},1032,["class"]),n(s,{class:g(["action-text",{active:a.isLiked}])},{default:c(()=>[d(p(a.likeCount>0?a.likeCount:"ç‚¹èµ"),1)]),_:2},1032,["class"])]),_:2},1032,["onClick"]),n(b,{class:"action-item",onClick:a=>D()},{default:c(()=>[n(s,{class:"action-icon"},{default:c(()=>[d("ğŸ’¬")]),_:1}),n(s,{class:"action-text"},{default:c(()=>[d(p(a.commentCount>0?a.commentCount:"è¯„è®º"),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(b,{class:"action-item",onClick:a=>{uni.showShareMenu({withShareTicket:!0})}},{default:c(()=>[n(s,{class:"action-icon"},{default:c(()=>[d("ğŸ“¤")]),_:1}),n(s,{class:"action-text"},{default:c(()=>[d("åˆ†äº«")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),a.hotComments&&a.hotComments.length>0?(i(),t(b,{key:2,class:"comments-preview"},{default:c(()=>[(i(!0),f(_,null,k(a.hotComments,(a,e)=>(i(),t(b,{key:e,class:"comment-item"},{default:c(()=>[n(s,{class:"comment-user"},{default:c(()=>[d(p(a.userNickname)+"ï¼š",1)]),_:2},1024),n(s,{class:"comment-content"},{default:c(()=>[d(p(a.content),1)]),_:2},1024)]),_:2},1024))),128)),a.commentCount>2?(i(),t(b,{key:0,class:"view-all-comments",onClick:a=>D()},{default:c(()=>[d(" æŸ¥çœ‹å…¨éƒ¨ "+p(a.commentCount)+" æ¡è¯„è®º â€º ",1)]),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)):v("",!0)];var e}),_:2},1024))),128)),0===M.value.length?(i(),t(b,{key:0,class:"empty-state"},{default:c(()=>[n(s,{class:"empty-icon"},{default:c(()=>[d("ğŸ’¬")]),_:1}),n(s,{class:"empty-text"},{default:c(()=>[d("æš‚æ— ç¤¾åŒºåŠ¨æ€")]),_:1}),n(s,{class:"empty-desc"},{default:c(()=>[d("å¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡åŠ¨æ€å§")]),_:1})]),_:1})):v("",!0)]),_:1})]),_:1})}}},[["__scopeId","data-v-92313d85"]]);export{w as default};
